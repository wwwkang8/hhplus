## 시나리오 요구사항 분석(콘서트 예약시스템)
[유저 대기열 API]
- 토큰 발급 : UUID + 유저의 대기순서 정보 포함
- 대기열 검증 : 토근 발급 이후, 모든 API 요청은 대기열에 해당 사용자가 존재하는지 검증
- 대기열 상태 확인 : 폴링 방식으로 현재 유저의 대기상태 확인

[예약가능날짜/좌석 API]
- 예약가능일자 조회 : 예약 가능한 날짜 조회 기능
- 좌석정보 조회 : 해당 날짜의 좌석정보 조회 기능(1~50번의 좌석번호 반환)
- 좌석 제한 : 최대 인원 50명 제한 기능

[좌석예약요청 API]
- 좌석 예약 기능 : 좌석번호, 날짜를 입력 받아 예약
- 임시 배정 기능 : 좌석 예약시 5분간 사용자에게 배정. 5분 만료 후 임시 배정 해제.

[잔액 충전/조회 API]
- 잔액 충전 : 사용자 식별자(아이디), 충전할 금액 받아서 충전
- 잔액 조회 : 사용자 식별자(아이디)로 잔액 조회

[결제 API]
- 결제 : 사용자의 잔액을 사용하여 결제처리 하고, 결제내역 생성.
- 대기열 만료 : 사용자에게 좌석 배정 후, 대기열 만료처리.

## 시퀀스 다이어그램
![image](https://github.com/wwwkang8/hhplus/assets/26863285/55d3efb0-1508-4812-af52-7d6ea093fd18)



## 아키텍쳐
- 레이어드 아키텍쳐 + 클린 아키텍쳐
- 도메인별로 다른 패키지 구조를 설계.
- 추후 Service 로직이 비대해지는 것을 방지하기 위해서 Usecase 모델을 추가.
  Controller --> Usecase --> Repository 방향으로 단방향 호출 방식

## API 명세

### [1. 예약 가능 날짜조회]
좌석 예약이 가능한 날짜를 조회합니다.

| 메서드 | 요청 URL | 기능 |
|--------|-----------| -----------|
| GET    |/api/seat  | 예약가능날짜조회|

Request
| 파라메터 | 타입 | 필수여부 | 설명 |
|--------|----------| ----------|----------|
| 없음     |         |           |          |

현재 시점에서 예약 가능한 콘서트의 모든 날짜를 리턴. 따라서 파라메터를 따로 입력받지 않습니다.

Response
| 필드 | 타입 | 필수여부 | 설명 |
|--------|----------------|-----|------------------|
| date   |List<String>    |필수  |예약 가능한 날짜|

### [2. 특정날짜의 예약가능한 좌석조회]
| 메서드 | 요청 URL | 기능 |
|--------|------------------|-----------------------|
| GET     |/api/seat/{date} | 해당날짜의 예약가능한 좌석조회|

Request
| 파라메터 | 타입 | 필수여부 | 설명 |
|--------|----------|-----|----------|
| date   |  String  | 필수 |   예약날짜|

Response
| 필드 | 타입 | 필수여부 | 설명 |
|--------|----------------|-----|-------------------|
| seat   |List<String>    |필수  |예약 가능한 좌석번호리스트|


### [3. 티켓 예약]
| 메서드 | 요청 URL | 기능 |
|--------|------------|----------|
| POST   |/api/ticket/| 티켓예약 |

Request
| 파라메터 | 타입 | 필수여부 | 설명 |
|--------|----------|-----|----------|
|userId |String| 필수 |사용자아이디|
|date   |String| 필수 |예약날짜|
|seatNumber|String| 필수 |좌석번호|

Response
| 필드 | 타입 | 필수여부 | 설명 |
|--------|----------------|-----|-------------------|
| seatNumber|String    |필수  |임시배정된 좌석번호|

### [4. 포인트 조회]
| 메서드 | 요청 URL | 기능 |
|--------|----------|----------|
| GET     |/api/point/{userId}| 포인트 조회|

Request
| 파라메터 | 타입 | 필수여부 | 설명 |
|--------|----------|-----|----------|
|userId |String| 필수 |사용자아이디|

Response
| 필드 | 타입 | 필수여부 | 설명 |
|--------|--------|-----|--------|
| point|Integer |필수  |포인트 잔액|

###  [5. 포인트 충전]
| 메서드 | 요청 URL |기능|
|--------|----------|----------|
| POST     |/api/point/charge| 포인트 충전   |

Request
| 파라메터 | 타입 | 필수여부 | 설명 |
|--------|----------|-----|----------|
|userId |String| 필수 |사용자아이디|
|amount |Integer| 필수 |충전할 포인트 금액|

Response
| 필드 | 타입 | 필수여부 | 설명 |
|--------|--------|-----|--------|
| point|Integer |필수  |포인트 잔액|

### [6. 결제]
| 메서드 | 요청 URL |기능|
|--------|----------|----------|
| POST     |/api/payment/| 결제  |

Request
| 파라메터 | 타입 | 필수여부 | 설명 |
|-----------|----------|-----|----------|
|userId |String| 필수 |사용자아이디|
|date |String| 필수 |예약 날짜|
|seatNumber |String| 필수 |예약 좌석번호|

Response
| 필드 | 타입 | 필수여부 | 설명 |
|--------|--------|-----|--------|
| result|String |필수  |좌석예약 성공여부|

## ERD 구조
![image](https://github.com/wwwkang8/hhplus/assets/26863285/48b77387-5f56-4b0f-a00e-0aa08c6f9c45)

1) 사용자 테이블뿐만 아니라 대기열 테이블에도 사용자 아이디를 넣은 이유는 대기열 테이블의 경우 대기상태를 계속해서 체크해야 하므로
조회 거래가 많을 것으로 예상된다. 다른 테이블과 JOIN을 하여 성능을 저하시키기보다는 애초에 대기열 테이블에 토큰을 넣는 것이 효율적이라고 판단.
2) 공연 테이블에서도 공연, 좌석 테이블을 따로 나누면 JOIN으로 인한 성능 저하게 있다고 판단하여 같은 테이블 안에 공연정보를 넣는 것으로 결정.
3) 이러한 구조 때문에 동시성 제어할 경우에는 ConcurrentHashMap 사용해야할 것으로 판단. 비관적락을 걸어버리면 테이블 전체에 조회도 못하게 락을 걸기 때문에
   성능이 떨어질 가능성이 높다.
